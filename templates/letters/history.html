{% extends "base.html" %}
{% block title %}Minhas Cartas | Cartas de Amor{% endblock %}
{% block content %}
<section class="space-y-6">
  <div class="animate__animated animate__fadeInDown flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold text-love-100">Minhas cartas</h1>
      <p class="mt-1 text-sm text-base-400">Seu historico completo de cartas criadas.</p>
    </div>
    <a href="{% url 'letters:create_step' step=1 %}" class="rounded-xl bg-love-400 px-4 py-2 text-sm font-semibold text-white">Nova carta</a>
  </div>

  <div class="grid gap-4">
    {% for letter in letters %}
      <article class="wow animate__animated animate__fadeInUp rounded-3xl border border-base-300 bg-base-200 p-5 shadow-soft">
        <div class="flex items-start justify-between gap-4">
          <div>
            <p class="text-xs text-love-200">Para {{ letter.beloved_name }}</p>
            <p class="mt-2 text-sm text-base-400">{{ letter.created_at|date:"d/m/Y H:i" }}</p>
            <p class="mt-3 font-serif text-xl text-love-100">{{ letter.message|default:"(Mensagem pendente)"|truncatechars:120 }}</p>
          </div>
          <span class="rounded-full px-3 py-1 text-xs {% if letter.is_paid %}bg-love-400/20 text-love-100{% else %}bg-base-300/40 text-base-400{% endif %}">
            {% if letter.is_paid %}Paga{% else %}Rascunho{% endif %}
          </span>
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
          <a href="{% url 'letters:preview' letter_id=letter.id %}" class="rounded-xl border border-love-200 px-3 py-2 text-xs text-love-100">Preview</a>
          <a href="{% url 'letters:payment' letter_id=letter.id %}" class="rounded-xl border border-love-200 px-3 py-2 text-xs text-love-100">Pagamento</a>
          {% if letter.is_paid %}
            <a href="{% url 'letters:public_letter' letter_id=letter.id %}" class="rounded-xl bg-love-400 px-3 py-2 text-xs font-semibold text-white">Abrir carta</a>
          {% endif %}
          <button
            type="button"
            data-open-modal="confirm-action-modal"
            data-confirm-action="{% url 'letters:delete_letter' letter_id=letter.id %}"
            data-confirm-title="Excluir carta?"
            data-confirm-text="Essa acao nao pode ser desfeita."
            data-confirm-button="Excluir carta"
            class="rounded-xl border border-love-500/60 px-3 py-2 text-xs text-love-200"
          >
            Excluir
          </button>
        </div>
      </article>
    {% empty %}
      <article class="rounded-3xl border border-base-300 bg-base-200 p-6 text-center">
        <p class="text-sm text-base-400">Voce ainda nao criou nenhuma carta.</p>
      </article>
    {% endfor %}
  </div>
</section>
{% endblock %}
